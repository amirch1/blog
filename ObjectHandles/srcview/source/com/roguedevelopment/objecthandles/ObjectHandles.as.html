<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>ObjectHandles.as</title>
<link rel="stylesheet" type="text/css" href="../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptASDoc">/**
 *  Latest information on this project can be found at http://www.rogue-development.com/objectHandles.html
 * 
 *  Copyright (c) 2010 Marc Hughes 
 * 
 *  Permission is hereby granted, free of charge, to any person obtaining a 
 *  copy of this software and associated documentation files (the "Software"), 
 *  to deal in the Software without restriction, including without limitation 
 *  the rights to use, copy, modify, merge, publish, distribute, sublicense, 
 *  and/or sell copies of the Software, and to permit persons to whom the Software 
 *  is furnished to do so, subject to the following conditions:
 * 
 *  The above copyright notice and this permission notice shall be included in all 
 *  copies or substantial portions of the Software.
 * 
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 *  INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 *  PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT 
 *  HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION 
 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE 
 *  SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. 
 * 
 * -------------------------------------------------------------------------------------------
 *  
 * Contributions by:
 *    
 *    Alexander Kludt
 *    Thomas Jakobi
 *    Mario Ernst
 *    Aaron Winkler
 *    Gregory Tappero
 *    Andrew Westberg
 * 
 * -------------------------------------------------------------------------------------------
 * 
 * Description:
 *    ObjectHandles gives the user the ability to move and resize a component with the mouse.
 * 
 * 
 * 
 **/</span>
<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">roguedevelopment</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">objecthandles</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">DisplayObject</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Sprite</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">EventDispatcher</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IEventDispatcher</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">KeyboardEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MouseEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Matrix</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Point</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ui</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Keyboard</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Dictionary</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">containers</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Canvas</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ClassFactory</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Container</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IFactory</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PropertyChangeEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ScrollEvent</span>;
    
    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"handleClicked"</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"com.roguedevelopment.objecthandles.HandleClickedEvent"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>
    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"objectMoved"</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"com.roguedevelopment.objecthandles.ObjectChangedEvent"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>
    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"objectResized"</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"com.roguedevelopment.objecthandles.ObjectChangedEvent"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>
    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"objectRotated"</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"com.roguedevelopment.objecthandles.ObjectChangedEvent"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>
    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"objectMoving"</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"com.roguedevelopment.objecthandles.ObjectChangedEvent"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>
    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"objectResizing"</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"com.roguedevelopment.objecthandles.ObjectChangedEvent"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>
    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"objectRotating"</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"com.roguedevelopment.objecthandles.ObjectChangedEvent"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">ObjectHandles</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">EventDispatcher</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptASDoc">/**
         * The default handle class to use.
         * 
         * SpriteHandle is good for Flex 3 based applications, or Flex 4 applications where the object handles live
         * inside a Canvas.
         * 
         * Switch it over to a VisualElementHandle for Flex 4 based applications.  Do this before creating ObjectHandle instances,
         * it's merely here to provide a convienent way to set the default globally.
         **/</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">defaultHandleClass</span>:<span class="ActionScriptDefault_Text">Class</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">SpriteHandle</span>;
        
        <span class="ActionScriptComment">// We need a zero point a lot, so lets not re-create it all the time.
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">zero</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">// The container that the object handles all live inside.
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">container</span>:<span class="ActionScriptDefault_Text">Sprite</span>;
        
        <span class="ActionScriptASDoc">/**
         * Should the user be allowed to select multiple items?
         **/</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">enableMultiSelect</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span>;
        
        <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">selectionManager</span>:<span class="ActionScriptDefault_Text">ObjectHandlesSelectionManager</span>;
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">handleFactory</span>:<span class="ActionScriptDefault_Text">IFactory</span>;
        
        <span class="ActionScriptASDoc">/**
         * When a single object is selected, these are the default handles that will appear.
         * 
         * You can modify it on an object by object basis by setting handleDescriptions in the
         * registerComponent method.
         **/</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">defaultHandles</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> [];
        
        <span class="ActionScriptASDoc">/**
         * These are the handles that appear around the bounding box when multiple objects are selected.
         **/</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">multiSelectHandles</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> [];
        
        <span class="ActionScriptComment">// Key = a Model, value = an Array of handles
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">handles</span>:<span class="ActionScriptDefault_Text">Dictionary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; 
        
        <span class="ActionScriptComment">// Key = a visual, value = the model
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">models</span>:<span class="ActionScriptDefault_Text">Dictionary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">// Key = a model, value = an array of constraints for that model.
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">constraints</span>:<span class="ActionScriptDefault_Text">Dictionary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">// A dictionary of the geometry of the models before the current drag operation started.        
</span>        <span class="ActionScriptComment">// This is set at the beginning of the user gesture.
</span>        <span class="ActionScriptComment">// Key = a visual, value = the model
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">originalModelGeometry</span>:<span class="ActionScriptDefault_Text">Dictionary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; 

        <span class="ActionScriptComment">// Key = a model, value = the visual
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">visuals</span>:<span class="ActionScriptDefault_Text">Dictionary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">// Key = a model, value = an array of HandleDescription objects;
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">handleDefinitions</span>:<span class="ActionScriptDefault_Text">Dictionary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; 
        
        <span class="ActionScriptComment">// Array of unused, visible=false handles
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">handleCache</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> [];
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">temp</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tempMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">isDragging</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">currentDragRole</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0;
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mouseDownPoint</span>:<span class="ActionScriptDefault_Text">Point</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mouseDownRotation</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">originalGeometry</span>:<span class="ActionScriptDefault_Text">DragGeometry</span>;
        
        <span class="ActionScriptASDoc">/**
         * An array of IConstraint objects that influence how the objects are allowed to be
         * moved or resized.
         * 
         * For instance, put in a SizeConstraint to set the max or minimum sizes. 
         **/</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">defaultConstraints</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> [];
        
        <span class="ActionScriptASDoc">/**
        * An array of IConstraint objects that influence how a group of objects are allowed to be
        * moved or resized.
        **/</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">multiSelectConstraints</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> [];
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">currentHandleConstraint</span>:<span class="ActionScriptDefault_Text">IFactory</span>;
        
        <span class="ActionScriptASDoc">/**
         * Flex 3 and Flex 4 applications manage children addition/removal differently (addChild vs. addElement) so I've abstracted
         * out that functionality into an IChildManager interface.
         **/</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_childManager</span>:<span class="ActionScriptDefault_Text">IChildManager</span>;
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">modelList</span>:<span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">=</span>[];
        
       <span class="ActionScriptComment">//used to remember object changes so
</span>       <span class="ActionScriptComment">//events can be fired when the changes are complete
</span>       <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">isMoved</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
       <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">isResized</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
       <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">isRotated</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
       
       <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">multiSelectModel</span>:<span class="ActionScriptDefault_Text">DragGeometry</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">DragGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            
       <span class="ActionScriptASDoc">/** 
       * Many times below we have the need to create lots of temporary DragGeometry objects,
       * we can use this one instead for times when we only need one at a time so we're not
       * allocating and deallocating tons of objects causing the garbage collector to go crazy.
       * 
       * Be very careful not to use this in a way that multiple places are depending on it at once!
       *  
       **/</span>
       <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tempGeometry</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">DragGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
       
       <span class="ActionScriptASDoc">/**
         * @param container The base container that all of the objects and the handles will be added to.
         * 
         * @param selectionManager A manager class that deals with which object(s) are currently selected.  If you 
         *                            pass null, a new one will be created for you.  It's often times useful to share 
         *                            a single selection manage across an entire app so that "selection" is global.
         * 
         * @param handleFactory A factory capable of creating IHandle objects.
         *                         If you pass null, a generic Flex 3 based factory will be created.
         *                         Use the Flex4HandleFactory to make Group compatible handles.
         * 
         * @param childManager Flex 3 and Flex 4 applications manage children addition/removal differently (addChild vs. addElement) so I've abstracted
         *                     out that functionality into an IChildManager interface that understands those differences.  In general, use Flex3ChildManager for 
         *                        Flex3 applications and use Flex4ChildManager for Flex 4 based applications.
         * 
        **/</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">ObjectHandles</span><span class="ActionScriptBracket/Brace">(</span>  <span class="ActionScriptDefault_Text">container</span>:<span class="ActionScriptDefault_Text">Sprite</span> <span class="ActionScriptOperator">,</span> 
                                        <span class="ActionScriptDefault_Text">selectionManager</span>:<span class="ActionScriptDefault_Text">ObjectHandlesSelectionManager</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> 
                                        <span class="ActionScriptDefault_Text">handleFactory</span>:<span class="ActionScriptDefault_Text">IFactory</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span>
                                        <span class="ActionScriptDefault_Text">childManager</span>:<span class="ActionScriptDefault_Text">IChildManager</span>    <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>    
                                        <span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>       
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span>;
            
            <span class="ActionScriptComment">//container.addEventListener(MouseEvent.ROLL_OUT, onContainerRollOut );
</span>            <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">ScrollEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SCROLL</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onContainerScroll</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">selectionManager</span> <span class="ActionScriptBracket/Brace">)</span>          
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectionManager</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">selectionManager</span>;           
            <span class="ActionScriptReserved">else</span>            
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectionManager</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ObjectHandlesSelectionManager</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">handleFactory</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleFactory</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">handleFactory</span>;
            <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleFactory</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ClassFactory</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">defaultHandleClass</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            
            
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SelectionEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ADDED_TO_SELECTION</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onSelectionAdded</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SelectionEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">REMOVED_FROM_SELECTION</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onSelectionRemoved</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SelectionEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SELECTION_CLEARED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onSelectionCleared</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            

                
            <span class="ActionScriptDefault_Text">multiSelectHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_UP</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_LEFT</span><span class="ActionScriptOperator">,</span> 
                <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
            
            <span class="ActionScriptDefault_Text">multiSelectHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_UP</span> <span class="ActionScriptOperator">,</span>
                <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>50<span class="ActionScriptOperator">,</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span> 
                <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
            
            <span class="ActionScriptDefault_Text">multiSelectHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_UP</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_RIGHT</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>100<span class="ActionScriptOperator">,</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
            
            <span class="ActionScriptDefault_Text">multiSelectHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_RIGHT</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>100<span class="ActionScriptOperator">,</span>50<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span> 
                <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
            
            <span class="ActionScriptDefault_Text">multiSelectHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_DOWN</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_RIGHT</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>100<span class="ActionScriptOperator">,</span>100<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span> 
                <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
            
            <span class="ActionScriptDefault_Text">multiSelectHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_DOWN</span> <span class="ActionScriptOperator">,</span>
                <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>50<span class="ActionScriptOperator">,</span>100<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
            
            <span class="ActionScriptDefault_Text">multiSelectHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_DOWN</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_LEFT</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span>100<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
            
            <span class="ActionScriptDefault_Text">multiSelectHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_LEFT</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span>50<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
                            
            <span class="ActionScriptDefault_Text">multiSelectHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ROTATE</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>100<span class="ActionScriptOperator">,</span>50<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span> 
                <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>20<span class="ActionScriptOperator">,</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
                
                
            <span class="ActionScriptDefault_Text">defaultHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_UP</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_LEFT</span><span class="ActionScriptOperator">,</span> 
                                                        <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptOperator">,</span>
                                                        <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
        
            <span class="ActionScriptDefault_Text">defaultHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_UP</span> <span class="ActionScriptOperator">,</span>
                                                        <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>50<span class="ActionScriptOperator">,</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span> 
                                                        <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
        
            <span class="ActionScriptDefault_Text">defaultHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_UP</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_RIGHT</span><span class="ActionScriptOperator">,</span>
                                                        <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>100<span class="ActionScriptOperator">,</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span>
                                                        <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
        
            <span class="ActionScriptDefault_Text">defaultHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_RIGHT</span><span class="ActionScriptOperator">,</span>
                                                        <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>100<span class="ActionScriptOperator">,</span>50<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span> 
                                                        <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
        
            <span class="ActionScriptDefault_Text">defaultHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_DOWN</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_RIGHT</span><span class="ActionScriptOperator">,</span>
                                                        <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>100<span class="ActionScriptOperator">,</span>100<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span> 
                                                        <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
            
            <span class="ActionScriptDefault_Text">defaultHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_DOWN</span> <span class="ActionScriptOperator">,</span>
                                                        <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>50<span class="ActionScriptOperator">,</span>100<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span>
                                                        <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
            
            <span class="ActionScriptDefault_Text">defaultHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_DOWN</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_LEFT</span><span class="ActionScriptOperator">,</span>
                                                        <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span>100<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span>
                                                        <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
        
            <span class="ActionScriptDefault_Text">defaultHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESIZE_LEFT</span><span class="ActionScriptOperator">,</span>
                                                        <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span>50<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span>
                                                        <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
        
        
            <span class="ActionScriptDefault_Text">defaultHandles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ROTATE</span><span class="ActionScriptOperator">,</span>
                                                        <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>100<span class="ActionScriptOperator">,</span>50<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">,</span> 
                                                        <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>20<span class="ActionScriptOperator">,</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>; 
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">childManager</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_childManager</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Flex3ChildManager</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_childManager</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">childManager</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">registerComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">multiSelectModel</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">multiSelectHandles</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Registers a component with the ObjectHandle manager.
         * 
         * @param dataModel The data model that represents this object.  This is where values will be commited to.  It should have a getter/setter for x,y,width, height, and optionally
         *                     rotation.
         * 
         * @param visualDisplay This is the actual on-screen display of the object.  We never set the coordinates of this object explictly, it should be bound
         *                      to your data model.
         * 
         * @param handleDescriptions If you want non-standard handles, create a list of HandleDescription objects and pass them in.
         * 
         * @param captureKeyEvents Should we add event listeners to support keyboard navigation?
         **/</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">registerComponent</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">dataModel</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptOperator">,</span> 
                                            <span class="ActionScriptDefault_Text">visualDisplay</span>:<span class="ActionScriptDefault_Text">IEventDispatcher</span> <span class="ActionScriptOperator">,</span> 
                                            <span class="ActionScriptDefault_Text">handleDescriptions</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> 
                                            <span class="ActionScriptDefault_Text">captureKeyEvents</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptOperator">,</span>
                                            <span class="ActionScriptDefault_Text">customConstraints</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">modelList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dataModel</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">visualDisplay</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">visualDisplay</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOUSE_DOWN</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onComponentMouseDown</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span> <span class="ActionScriptBracket/Brace">)</span>;
    
                <span class="ActionScriptDefault_Text">visualDisplay</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">SelectionEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SELECTED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleSelection</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">captureKeyEvents</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                 <span class="ActionScriptDefault_Text">visualDisplay</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">KEY_DOWN</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onKeyDown</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">models</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">visualDisplay</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataModel</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">dataModel</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">PropertyChangeEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PROPERTY_CHANGE</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onModelChange</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">visuals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataModel</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">visualDisplay</span>;     
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">handleDescriptions</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">handleDefinitions</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">dataModel</span> <span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">handleDescriptions</span>;
            <span class="ActionScriptBracket/Brace">}</span>  
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">customConstraints</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">constraints</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataModel</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">customConstraints</span>;
            <span class="ActionScriptBracket/Brace">}</span>             
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
          * A constraint limits the way something could be sized or moved.  For instance, you could have a minimum size. 
          *  
          * There are 3 types of constraints.
          * 
          * A constraint that applies to a single component (set in the registerComponent call)
          * A constraint that applies to groups of components during multi selection (set in addMultiSelectConstraint)
          * Constraints that apply to all individual components
          * 
          * This method adds constraints to that last one.
          **/</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addDefaultConstraint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">constraint</span>:<span class="ActionScriptDefault_Text">IConstraint</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">defaultConstraints</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">constraint</span> <span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>


        <span class="ActionScriptASDoc">/**
          * A constraint limits the way something could be sized or moved.  For instance, you could have a minimum size. 
          *  
          * There are 3 types of constraints.
          * 
          * A constraint that applies to a single component (set in the registerComponent call)
          * Constraints that apply to all individual components (set in addDefaultConstraint)
          * A constraint that applies to groups of components during multi selection 
          * 
          * This method adds constraints to that last one.
          **/</span>         
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addMultiSelectConstraint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">constraint</span>:<span class="ActionScriptDefault_Text">IConstraint</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">multiSelectConstraints</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">constraint</span> <span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getDisplayForModel</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">IEventDispatcher</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">visuals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onKeyDown</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">t</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">DragGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">keyCode</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">Keyboard</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">UP</span> : <span class="ActionScriptDefault_Text">t</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">--</span>; <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">Keyboard</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">DOWN</span> : <span class="ActionScriptDefault_Text">t</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">++</span>; <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">Keyboard</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RIGHT</span> : <span class="ActionScriptDefault_Text">t</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">++</span>; <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">Keyboard</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LEFT</span> : <span class="ActionScriptDefault_Text">t</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">--</span>; <span class="ActionScriptReserved">break</span>;             
                <span class="ActionScriptReserved">default</span>:<span class="ActionScriptReserved">return</span>; 
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">originalGeometry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                                
            
            <span class="ActionScriptDefault_Text">applyConstraints</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">t</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOVE</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">applyTranslation</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Returns true if the given model should have a movement handle.
         **/</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">hasMovementHandle</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">desiredHandles</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getHandleDefinitions</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">handle</span>:<span class="ActionScriptDefault_Text">HandleDescription</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">desiredHandles</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isMove</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">role</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">unregisterModel</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">display</span>:<span class="ActionScriptDefault_Text">IEventDispatcher</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">visuals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">unregisterComponent</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">display</span> <span class="ActionScriptBracket/Brace">)</span>;
            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">unregisterComponent</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">visualDisplay</span>:<span class="ActionScriptDefault_Text">IEventDispatcher</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">visualDisplay</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOUSE_DOWN</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onComponentMouseDown</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">visualDisplay</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">SelectionEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SELECTED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleSelection</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">visualDisplay</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">KEY_DOWN</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onKeyDown</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dataModel</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">findModel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">visualDisplay</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">DisplayObject</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">dataModel</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">dataModel</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">PropertyChangeEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PROPERTY_CHANGE</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onModelChange</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">modelList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">splice</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">modelList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dataModel</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> 1 <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">visuals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataModel</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">models</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">visualDisplay</span><span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dataModel</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1 <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clearSelection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onModelChange</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">PropertyChangeEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">property</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">"x"</span>:
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">"y"</span>:
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">"width"</span>:
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">"height"</span>:
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">"rotation"</span>: <span class="ActionScriptDefault_Text">updateHandlePositions</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">break</span>;
                
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">"isLocked"</span>: <span class="ActionScriptDefault_Text">redrawHandle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onSelectionAdded</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">SelectionEvent</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">setupHandles</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onSelectionRemoved</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">SelectionEvent</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">setupHandles</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onSelectionCleared</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">SelectionEvent</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>            
            <span class="ActionScriptDefault_Text">setupHandles</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">lastSelectedModel</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onComponentMouseDown</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>           
            
            <span class="ActionScriptDefault_Text">handleSelection</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOUSE_MOVE</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onContainerMouseMove</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOUSE_UP</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onContainerMouseUp</span> <span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">try</span>
            <span class="ActionScriptBracket/Brace">{</span>
              <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setFocus</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">catch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>:<span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">)</span>{}
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">findModel</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">DisplayObject</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptOperator">!</span> <span class="ActionScriptDefault_Text">hasMovementHandle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOVE</span>; <span class="ActionScriptComment">// a mouse down on the component itself as opposed to a handle is a move operation.
</span>                <span class="ActionScriptDefault_Text">currentHandleConstraint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptDefault_Text">handleBeginDrag</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onContainerRollOut</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">isDragging</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>; 
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onContainerMouseUp</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MouseEvent</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
           <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isMoved</span><span class="ActionScriptBracket/Brace">)</span>
           <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ObjectChangedEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ObjectChangedEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">OBJECT_MOVED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
           <span class="ActionScriptBracket/Brace">}</span>
           <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isResized</span><span class="ActionScriptBracket/Brace">)</span>
           <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ObjectChangedEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ObjectChangedEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">OBJECT_RESIZED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
           <span class="ActionScriptBracket/Brace">}</span>
           <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isRotated</span><span class="ActionScriptBracket/Brace">)</span>
           <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ObjectChangedEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ObjectChangedEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">OBJECT_ROTATED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
           <span class="ActionScriptBracket/Brace">}</span>
           
           <span class="ActionScriptDefault_Text">isMoved</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
           <span class="ActionScriptDefault_Text">isResized</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
           <span class="ActionScriptDefault_Text">isRotated</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
           <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOUSE_MOVE</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onContainerMouseMove</span> <span class="ActionScriptBracket/Brace">)</span>;
           <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOUSE_UP</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onContainerMouseUp</span> <span class="ActionScriptBracket/Brace">)</span>;
        
           <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 1 <span class="ActionScriptBracket/Brace">)</span>
           <span class="ActionScriptBracket/Brace">{</span>
               <span class="ActionScriptDefault_Text">multiSelectModel</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copyFrom</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;               
                  <span class="ActionScriptDefault_Text">updateHandlePositions</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">multiSelectModel</span><span class="ActionScriptBracket/Brace">)</span>;
           <span class="ActionScriptBracket/Brace">}</span>
           
           <span class="ActionScriptDefault_Text">isDragging</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
               
    
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onContainerScroll</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">ScrollEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">models</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">updateHandlePositions</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// Pulling these 4 variables to a member level var so we allocate less of them, this method gets called a lot
</span>        <span class="ActionScriptComment">// so a ton of objects were being created and eventually destroyed leading to some choppiness.
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">translation</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">DragGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
       
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onContainerMouseMove</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MouseEvent</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">locked</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">obj</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                     
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOwnProperty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"isLocked"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"isLocked"</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">locked</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span> <span class="ActionScriptDefault_Text">isDragging</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">locked</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span>; <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">//var translation:DragGeometry = new DragGeometry();
</span>            <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span><span class="ActionScriptOperator">=</span>0;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isMove</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">isMoved</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">applyMovement</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">applyConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isResizeLeft</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">isResized</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">applyResizeLeft</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span> <span class="ActionScriptBracket/Brace">)</span>;              
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isResizeUp</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">currentDragRole</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">isResized</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">applyResizeUp</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span> <span class="ActionScriptBracket/Brace">)</span>;                
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isResizeRight</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">isResized</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">applyResizeRight</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span> <span class="ActionScriptBracket/Brace">)</span>;             
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isResizeDown</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">isResized</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">applyResizeDown</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span> <span class="ActionScriptBracket/Brace">)</span>;                      
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isRotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">isRotated</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">applyRotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span> <span class="ActionScriptBracket/Brace">)</span>;              
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">applyConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">applyAnchorPoint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">applyTranslation</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">translation</span> <span class="ActionScriptBracket/Brace">)</span>;            
            
            <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">updateAfterEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;    
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isMoved</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                                
                <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ObjectChangedEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">ObjectChangedEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">OBJECT_MOVING</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isResized</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ObjectChangedEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">ObjectChangedEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">OBJECT_RESIZING</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isRotated</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>                
                <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ObjectChangedEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">ObjectChangedEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">OBJECT_ROTATING</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
        * When resizing, there should be an "anchor point" that doesn't move.  Sometimes, we need to move the entire object around so
        * that anchor point doesn't move.
        * 
        * Example:  Resizing a rectangle larger to the left.  The width should increase and the whole thing should move to the left so the
        *             right side stays stationary.
        * 
        * This method applies an x/y translation based upon a width/height translation and drag role
        **/</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">applyAnchorPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">original</span>:<span class="ActionScriptDefault_Text">DragGeometry</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span>:<span class="ActionScriptDefault_Text">DragGeometry</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">currentDragRole</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isRotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mid</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span>  <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">original</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">original</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptBracket/Brace">)</span> ;
                <span class="ActionScriptComment">// We want to rotate around the center instead of around the upper left corner.
</span>                <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">identity</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">original</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">mid</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptComment">// this is where the center was.
</span>                
                <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">identity</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">original</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">mid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">mid</span> <span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// This is where the new center should be.
</span>                
                <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">mid</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">mid</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                
            <span class="ActionScriptBracket/Brace">}</span>
            
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isResize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">currentDragRole</span><span class="ActionScriptBracket/Brace">)</span>  <span class="ActionScriptBracket/Brace">)</span> 
            <span class="ActionScriptBracket/Brace">{</span>
        
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">proportion</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getAnchorProportion</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">identity</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">original</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">proportion</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span>  <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">proportion</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span>  <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span>;
                <span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">proportion</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">proportion</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span>;
                
                
                
                <span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                
                
    <span class="ActionScriptComment">// More readable version of the optimized code above:            
</span>    <span class="ActionScriptComment">//                var proportion:Point = getAnchorProportion( currentDragRole );
</span>    <span class="ActionScriptComment">//            var m:Matrix = new Matrix();      
</span>    <span class="ActionScriptComment">//            m.rotate(toRadians(rotation));
</span>    <span class="ActionScriptComment">//            var anchorPoint:Point = new Point( proportion.x *  originalGeometry.width, proportion.y * originalGeometry.height );
</span>    <span class="ActionScriptComment">//            var destAnchorPoint:Point = new Point( proportion.x *  (translation.width + originalGeometry.width), proportion.y * (translation.height + originalGeometry.height) );
</span>    <span class="ActionScriptComment">//            
</span>    <span class="ActionScriptComment">//            var offset:Point = new Point(destAnchorPoint.x - anchorPoint.x, destAnchorPoint.y - anchorPoint.y);
</span>    <span class="ActionScriptComment">//            
</span>    <span class="ActionScriptComment">//            offset = m.transformPoint( offset );      
</span>    <span class="ActionScriptComment">//            translation.x += offset.x;
</span>    <span class="ActionScriptComment">//            translation.y += offset.y;
</span>            <span class="ActionScriptBracket/Brace">}</span>
            
       <span class="ActionScriptBracket/Brace">}</span>
        
             <span class="ActionScriptASDoc">/**
        * 
        * Figure out which point is the anchor, and then return what the width/height proportion of 
        * the translation applies to it.
        * 
        * Anchor = This is the point that shouldn't move. 
        * I'm only going to worry about the 8 main places a handle could be, so this will get
        * a bit weird if you have custom handles in odd places.  If that's the case for you,
        * subclass this class and override getAnchorProportion
        **/</span>         
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getAnchorProportion</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">resizeHandleRole</span>:<span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Point</span>
        <span class="ActionScriptBracket/Brace">{</span>
             <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">anchorPoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isResizeUp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">resizeHandleRole</span><span class="ActionScriptBracket/Brace">)</span>  <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isResizeLeft</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">resizeHandleRole</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// Upper left handle being used, so the lower right corner should not move.
</span>                    <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> -1; 
                    <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> -1; 
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isResizeRight</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">resizeHandleRole</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// Upper right handle
</span>                    <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> 0; 
                    <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> -1;                     
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> -0.5;
                    <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> -1;                                        
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isResizeDown</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">resizeHandleRole</span><span class="ActionScriptBracket/Brace">)</span>  <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isResizeLeft</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">resizeHandleRole</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// lower left handle
</span>                    <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> -1;
                    <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isResizeRight</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">resizeHandleRole</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// lower right handle
</span>                    <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> 0;
                    <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0;                    
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// middle bottom handle
</span>                    <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> -0.5;
                    <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0;                                        
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isResizeLeft</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">resizeHandleRole</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// left middle handle
</span>                <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> -1;
                <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> -0.5;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// right middle
</span>                <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptDefault_Text">anchorPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> -0.5;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">anchorPoint</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">applyTranslationForSingleObject</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">current</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">originalGeometry</span>:<span class="ActionScriptDefault_Text">DragGeometry</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOwnProperty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"x"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOwnProperty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"y"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOwnProperty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"width"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOwnProperty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"height"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOwnProperty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"rotation"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span>;
            
            <span class="ActionScriptDefault_Text">updateHandlePositions</span><span class="ActionScriptBracket/Brace">(</span>  <span class="ActionScriptDefault_Text">current</span> <span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
    
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">applyTranslation</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">translation</span>:<span class="ActionScriptDefault_Text">DragGeometry</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 1 <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>                               
                <span class="ActionScriptDefault_Text">applyTranslationForSingleObject</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">originalGeometry</span> <span class="ActionScriptBracket/Brace">)</span>;                    
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 1 <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>                
                <span class="ActionScriptDefault_Text">applyTranslationForSingleObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">multiSelectModel</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span> <span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">subObject</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    
                    
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">subTranslation</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">calculateTranslationFromMultiTranslation</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">subObject</span> <span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">originalGeometry</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">originalModelGeometry</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">subObject</span> <span class="ActionScriptBracket/Brace">]</span>
                    <span class="ActionScriptComment">// At this point, constraints to the entire group have already been applied, but we need to apply per component constraints.
</span>                    
                    <span class="ActionScriptDefault_Text">applySingleObjectConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subObject</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">subTranslation</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span>;

                    <span class="ActionScriptDefault_Text">applyTranslationForSingleObject</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">subObject</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">subTranslation</span> <span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">originalModelGeometry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">subObject</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
        * Convienence method for dealing with tempGeometry, again BE VERY CAREFUL when calling it.
        **/</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">copyToTempGeometry</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">obj</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">tempGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span>;
            <span class="ActionScriptDefault_Text">tempGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span>;
            <span class="ActionScriptDefault_Text">tempGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">tempGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOwnProperty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"rotation"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">tempGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOwnProperty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"isLocked"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">tempGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isLocked</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isLocked</span>;

        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">selectionMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">objectMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">relativeGeometry</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptASDoc">/**
         * Calculates the translation of a single object in a group of objects that is selected
         * based on the translation of the entire group.
         **/</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">calculateTranslationFromMultiTranslation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">overallTranslation</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptOperator">,</span>  <span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">DragGeometry</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rv</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">DragGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            
            <span class="ActionScriptComment">// This is the rotation, scaling, and translation of the entire selection.
</span>            <span class="ActionScriptDefault_Text">selectionMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">identity</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">selectionMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">overallTranslation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">selectionMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">scale</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">overallTranslation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">overallTranslation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">selectionMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">translate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">overallTranslation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">overallTranslation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;

             <span class="ActionScriptComment">// This is the point the object is relative to the selection
</span>            
            <span class="ActionScriptDefault_Text">relativeGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">originalModelGeometry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">relativeGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">originalModelGeometry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;            
            
            <span class="ActionScriptDefault_Text">objectMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">identity</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">objectMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">overallTranslation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptOperator">+</span>  <span class="ActionScriptDefault_Text">originalModelGeometry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;             
            <span class="ActionScriptDefault_Text">objectMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">translate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">relativeGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">relativeGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">translatedZeroPoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">objectMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">translatedTopRightCorner</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">objectMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">originalModelGeometry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">,</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">translatedBottomLeftCorner</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">objectMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">originalModelGeometry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;            

            <span class="ActionScriptDefault_Text">translatedZeroPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">selectionMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">translatedZeroPoint</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">translatedTopRightCorner</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">selectionMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">translatedTopRightCorner</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">translatedBottomLeftCorner</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">selectionMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">translatedBottomLeftCorner</span> <span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptComment">// uncomment to draw debug graphics.
</span><span class="ActionScriptComment">//            container.graphics.lineStyle(2,0xff0000,0.5);
</span><span class="ActionScriptComment">//            container.graphics.drawCircle(translatedZeroPoint.x, translatedZeroPoint.y , 4);
</span><span class="ActionScriptComment">//            container.graphics.lineStyle(2,0xffff00,0.5);
</span><span class="ActionScriptComment">//            container.graphics.drawCircle(translatedTopRightCorner.x, translatedTopRightCorner.y , 4);
</span>            
            
            
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">targetWidth</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">distance</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">translatedZeroPoint</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translatedTopRightCorner</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">targetHeight</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">distance</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">translatedZeroPoint</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translatedBottomLeftCorner</span> <span class="ActionScriptBracket/Brace">)</span> ;
            
            <span class="ActionScriptComment">// remember, rv is the CHANGE in value from the original, not an absolute value.
</span>            <span class="ActionScriptDefault_Text">rv</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">translatedZeroPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">originalModelGeometry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>; 
            <span class="ActionScriptDefault_Text">rv</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">translatedZeroPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">originalModelGeometry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptDefault_Text">rv</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">targetWidth</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">originalModelGeometry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span>;
            <span class="ActionScriptDefault_Text">rv</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">targetHeight</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">originalModelGeometry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">targetAngle</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toDegrees</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">atan2</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">translatedTopRightCorner</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">translatedZeroPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translatedTopRightCorner</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">translatedZeroPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">rv</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">targetAngle</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">originalModelGeometry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">overallTranslation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">rv</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">applyConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">translation</span>:<span class="ActionScriptDefault_Text">DragGeometry</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">currentDragRole</span>:<span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">constraint</span>:<span class="ActionScriptDefault_Text">IConstraint</span>;
            

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">currentHandleConstraint</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">currentHandleConstraint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">newInstance</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">applyConstraint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 1 <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Deal with multi-select
</span>                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">constraint</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">multiSelectConstraints</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">constraint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">applyConstraint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> 
                <span class="ActionScriptReserved">return</span>;
                <span class="ActionScriptComment">// we'll apply per-component constraints in the applyTranslation method
</span>            <span class="ActionScriptBracket/Brace">}</span>
            
            
             <span class="ActionScriptComment">// Single object selection constraint...
</span>             <span class="ActionScriptDefault_Text">applySingleObjectConstraints</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span>;
                
            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">applySingleObjectConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">modelObject</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">originalGeometry</span>:<span class="ActionScriptDefault_Text">DragGeometry</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span>:<span class="ActionScriptDefault_Text">DragGeometry</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">currentDragRole</span>:<span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">constraint</span>:<span class="ActionScriptDefault_Text">IConstraint</span>;
            
            <span class="ActionScriptComment">// Default ObjectHandles wide constraints
</span>            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">constraint</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">defaultConstraints</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">constraint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">applyConstraint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// Constraints that are set on a per component basis in the registerComponent call
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">customConstraints</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">constraints</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">modelObject</span> <span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">customConstraints</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">constraint</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">customConstraints</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">constraint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">applyConstraint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span> 
            
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">applyRotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">proposed</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            
            
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">centerRotatedAmount</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> 
                                             <span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mouseDownRotation</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> 
                                             <span class="ActionScriptDefault_Text">getAngleInRadians</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageY</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">identity</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//var oldRotationMatrix:Matrix = new Matrix();
</span>            <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">oldCenter</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
<span class="ActionScriptComment">//          
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">newRotationMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//newRotationMatrix.rotate( toRadians(originalGeometry.rotation) );
</span>            <span class="ActionScriptDefault_Text">newRotationMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">translate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">oldCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">oldCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//-originalGeometry.width/2,-originalGeometry.height/2);                                    
</span>            <span class="ActionScriptDefault_Text">newRotationMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">centerRotatedAmount</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">newRotationMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">translate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">oldCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">oldCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            
            
                                      
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">newOffset</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">newRotationMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            
           <span class="ActionScriptComment">// proposed.x += newOffset.x;
</span>           <span class="ActionScriptComment">// proposed.y += newOffset.y;
</span>            <span class="ActionScriptDefault_Text">proposed</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toDegrees</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">centerRotatedAmount</span><span class="ActionScriptBracket/Brace">)</span>;
            
            
        <span class="ActionScriptBracket/Brace">}</span>    
        
        
 
        
         <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getAngleInRadians</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">y</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
         <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">identity</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mousePos</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalToLocal</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">angle1</span>:<span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span><span class="ActionScriptBracket/Brace">)</span>  <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">originalCenter</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">originalCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">offset</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span>  <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptBracket/Brace">)</span>;
            
<span class="ActionScriptComment">////        This will draw some debug lines
</span><span class="ActionScriptComment">//            container.graphics.clear();
</span><span class="ActionScriptComment">//            container.graphics.lineStyle(1,0xff0000);
</span><span class="ActionScriptComment">//            container.graphics.moveTo( originalCenter.x, originalCenter.y );
</span><span class="ActionScriptComment">//            container.graphics.lineTo( mousePos.x, mousePos.y );
</span><span class="ActionScriptComment">//            container.graphics.lineStyle(1,0x00ff00);
</span><span class="ActionScriptComment">//            var ang:Number = Math.atan2(mousePos.y - originalCenter.x, mousePos.x - originalCenter.y) ;
</span><span class="ActionScriptComment">//            container.graphics.moveTo( originalCenter.x, originalCenter.y );
</span><span class="ActionScriptComment">//            container.graphics.lineTo( originalCenter.x + Math.cos(ang)*300, originalCenter.y + Math.sin(ang)*300);
</span>            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">Canvas</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parentCanvas</span>:<span class="ActionScriptDefault_Text">Canvas</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Canvas</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">atan2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mousePos</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">parentCanvas</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">verticalScrollPosition</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">originalCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mousePos</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">parentCanvas</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">horizontalScrollPosition</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">originalCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span> ; 
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> 
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">atan2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mousePos</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">originalCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mousePos</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">originalCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span> ; 
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">applyMovement</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>           
            <span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageX</span>;
            <span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageY</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">localDown</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalToLocal</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">mouseDownPoint</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">current</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalToLocal</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mouseDelta</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">localDown</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">localDown</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            
            <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mouseDelta</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mouseDelta</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">applyResizeRight</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">containerOriginalMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalToLocal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">mouseDownPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mouseDownPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;       
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">containerMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalToLocal</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// "local coordinates" = the coordinate system that is relative to the piece that moves around.
</span>            
            <span class="ActionScriptComment">// matrix describes the current rotation and helps us to go from container to local coordinates 
</span>            <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">identity</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">// The inverse matrix helps us to go from local to container coordinates
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">invMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">invert</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// The point where we pressed the mouse down in local coordinates
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">localOriginalMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">invMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">containerOriginalMousePoint</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">// The point where the mouse is currently in local coordinates
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">localMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">invMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">containerMousePoint</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// How far along the X axis (in local coordinates) has the mouse been moved?  This is the amount the user has tried to resize the object
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">resizeDistance</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">localMousePoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">localOriginalMousePoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            
            <span class="ActionScriptComment">// So our new width is the original width plus that resize amount
</span>            <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">+=</span>  <span class="ActionScriptDefault_Text">resizeDistance</span>;
            
<span class="ActionScriptComment">//            applyConstraints(translation, currentDragRole );
</span>            
<span class="ActionScriptComment">//            // Now, that we've resize the object, we need to know where the upper left corner should get moved to because when we resize left, we have to move left.
</span><span class="ActionScriptComment">//            var translationp:Point = matrix.transformPoint( zero );
</span><span class="ActionScriptComment">//            
</span><span class="ActionScriptComment">//            translation.x +=  translationp.x;
</span><span class="ActionScriptComment">//            translation.y +=  translationp.y;
</span>        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">applyResizeDown</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">containerOriginalMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalToLocal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">mouseDownPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mouseDownPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;       
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">containerMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalToLocal</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// "local coordinates" = the coordinate system that is relative to the piece that moves around.
</span>            
            <span class="ActionScriptComment">// matrix describes the current rotation and helps us to go from container to local coordinates 
</span>            <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">identity</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">// The inverse matrix helps us to go from local to container coordinates
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">invMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">invert</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// The point where we pressed the mouse down in local coordinates
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">localOriginalMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">invMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">containerOriginalMousePoint</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">// The point where the mouse is currently in local coordinates
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">localMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">invMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">containerMousePoint</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// How far along the X axis (in local coordinates) has the mouse been moved?  This is the amount the user has tried to resize the object
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">resizeDistance</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">localMousePoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">localOriginalMousePoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            
            <span class="ActionScriptComment">// So our new width is the original width plus that resize amount
</span>            <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">+=</span>  <span class="ActionScriptDefault_Text">resizeDistance</span>;
            
<span class="ActionScriptComment">//            applyConstraints(translation, currentDragRole );
</span>            
<span class="ActionScriptComment">//            // Now, that we've resize the object, we need to know where the upper left corner should get moved to because when we resize left, we have to move left.
</span><span class="ActionScriptComment">//            var translationp:Point = matrix.transformPoint( zero );
</span><span class="ActionScriptComment">//            
</span><span class="ActionScriptComment">//            translation.x +=  translationp.x;
</span><span class="ActionScriptComment">//            translation.y +=  translationp.y;
</span>        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">applyResizeLeft</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">containerOriginalMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalToLocal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">mouseDownPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mouseDownPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;       
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">containerMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalToLocal</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// "local coordinates" = the coordinate system that is relative to the piece that moves around.
</span>            
            <span class="ActionScriptComment">// matrix describes the current rotation and helps us to go from container to local coordinates 
</span>            <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">identity</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">// The inverse matrix helps us to go from local to container coordinates
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">invMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">invert</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// The point where we pressed the mouse down in local coordinates
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">localOriginalMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">invMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">containerOriginalMousePoint</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">// The point where the mouse is currently in local coordinates
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">localMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">invMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">containerMousePoint</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// How far along the X axis (in local coordinates) has the mouse been moved?  This is the amount the user has tried to resize the object
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">resizeDistance</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">localOriginalMousePoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">localMousePoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> ;
            
            <span class="ActionScriptComment">// So our new width is the original width plus that resize amount
</span>            <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">+=</span>  <span class="ActionScriptDefault_Text">resizeDistance</span>;
            
            
<span class="ActionScriptComment">//            applyConstraints(translation, currentDragRole );
</span>            
<span class="ActionScriptComment">//            // Now, that we've resize the object, we need to know where the upper left corner should get moved to because when we resize left, we have to move left.
</span><span class="ActionScriptComment">//            var translationp:Point = matrix.transformPoint( new Point(-translation.width,0) );
</span><span class="ActionScriptComment">//            
</span><span class="ActionScriptComment">//            translation.x +=  translationp.x;
</span><span class="ActionScriptComment">//            translation.y +=  translationp.y;
</span>        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">applyResizeUp</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">translation</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">containerOriginalMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalToLocal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">mouseDownPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">mouseDownPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;       
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">containerMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalToLocal</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// "local coordinates" = the coordinate system that is relative to the piece that moves around.
</span>            
            <span class="ActionScriptComment">// matrix describes the current rotation and helps us to go from container to local coordinates 
</span>            <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">identity</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">// The inverse matrix helps us to go from local to container coordinates
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invMatrix</span>:<span class="ActionScriptDefault_Text">Matrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">invMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">invert</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// The point where we pressed the mouse down in local coordinates
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">localOriginalMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">invMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">containerOriginalMousePoint</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">// The point where the mouse is currently in local coordinates
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">localMousePoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">invMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">containerMousePoint</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// How far along the Y axis (in local coordinates) has the mouse been moved?  This is the amount the user has tried to resize the object
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">resizeDistance</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">localOriginalMousePoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">localMousePoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> ;
            
            <span class="ActionScriptComment">// So our new width is the original width plus that resize amount
</span>            <span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">+=</span>  <span class="ActionScriptDefault_Text">resizeDistance</span>;
            
<span class="ActionScriptComment">//            applyConstraints(translation, currentDragRole );
</span>            
            <span class="ActionScriptComment">// Now, that we've resize the object, we need to know where the upper left corner should get moved to because when we resize left, we have to move left.
</span><span class="ActionScriptComment">//            var translationp:Point = matrix.transformPoint( new Point(0, -translation.height) );
</span><span class="ActionScriptComment">//            
</span><span class="ActionScriptComment">//            translation.x += translationp.x;
</span><span class="ActionScriptComment">//            translation.y += translationp.y;
</span>        <span class="ActionScriptBracket/Brace">}</span>       
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">findModel</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">display</span>:<span class="ActionScriptDefault_Text">DisplayObject</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Object</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">models</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">display</span> <span class="ActionScriptBracket/Brace">]</span>;
            
            
            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">==</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parent</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">display</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parent</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">DisplayObject</span>;
                <span class="ActionScriptDefault_Text">model</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">models</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">display</span> <span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">model</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">handleSelection</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span> : <span class="ActionScriptDefault_Text">MouseEvent</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">findModel</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">DisplayObject</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptOperator">!</span> <span class="ActionScriptDefault_Text">model</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span>; <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// if shift key - add/remove to selection
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">shiftKey</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">enableMultiSelect</span><span class="ActionScriptBracket/Brace">)</span>  
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isSelected</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFromSelected</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addToSelected</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>            
            <span class="ActionScriptBracket/Brace">}</span> 
            <span class="ActionScriptReserved">else</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isSelected</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setSelected</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">handleBeginDrag</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span> : <span class="ActionScriptDefault_Text">MouseEvent</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">isDragging</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;  
            <span class="ActionScriptDefault_Text">mouseDownPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageY</span> <span class="ActionScriptBracket/Brace">)</span>;           
            <span class="ActionScriptDefault_Text">originalGeometry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// saving old coordinates
</span>            <span class="ActionScriptDefault_Text">originalModelGeometry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">for each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">current</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">originalModelGeometry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">current</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getGeometryForObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">current</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">mouseDownRotation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">originalGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">toDegrees</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">getAngleInRadians</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stageY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;         
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lastSelectedModel</span>:<span class="ActionScriptDefault_Text">Object</span>;
        
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getCurrentSelection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Array</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rv</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> [];
            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentlySelected</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">visuals</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">rv</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>                
            <span class="ActionScriptBracket/Brace">}</span>            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">rv</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setupHandles</span><span class="ActionScriptBracket/Brace">(</span>  <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>   
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">selection</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getCurrentSelection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">selection</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0 <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">removeHandles</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">lastSelectedModel</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">removeHandles</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">multiSelectModel</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">selection</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 1 <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// single object selected
</span>                <span class="ActionScriptDefault_Text">createHandlesFor</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">selection</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">updateHandlePositions</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">selection</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">removeHandles</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">multiSelectModel</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">removeHandles</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">lastSelectedModel</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">lastSelectedModel</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">selection</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> ;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Many objects selected
</span>                <span class="ActionScriptDefault_Text">removeHandles</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">lastSelectedModel</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">geo</span>:<span class="ActionScriptDefault_Text">DragGeometry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">selectionManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geo</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">multiSelectModel</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copyFrom</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">geo</span> <span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">createHandlesFor</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">multiSelectModel</span> <span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">updateHandlePositions</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">multiSelectModel</span> <span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">lastSelectedModel</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">multiSelectModel</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createHandlesFor</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">desiredHandles</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getHandleDefinitions</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">descriptor</span>:<span class="ActionScriptDefault_Text">HandleDescription</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">desiredHandles</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">createHandle</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">descriptor</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getHandleDefinitions</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptBracket/Brace">)</span> :<span class="ActionScriptDefault_Text">Array</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">desiredHandles</span>:<span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptDefault_Text">desiredHandles</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">handleDefinitions</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">model</span> <span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span> <span class="ActionScriptDefault_Text">desiredHandles</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">desiredHandles</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">defaultHandles</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">desiredHandles</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createHandle</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">descriptor</span>:<span class="ActionScriptDefault_Text">HandleDescription</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">current</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">handles</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptOperator">!</span> <span class="ActionScriptDefault_Text">current</span> <span class="ActionScriptBracket/Brace">)</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">current</span> <span class="ActionScriptOperator">=</span> [];
                <span class="ActionScriptDefault_Text">handles</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">current</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">// todo: use cached handles for performance.
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">handle</span>:<span class="ActionScriptDefault_Text">IHandle</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">descriptor</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleFactory</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">handle</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">descriptor</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleFactory</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">newInstance</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">IHandle</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">handle</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">handleFactory</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">newInstance</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">IHandle</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">targetModel</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">model</span>;
            <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleDescriptor</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">descriptor</span>;
            <span class="ActionScriptDefault_Text">connectHandleEvents</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">handle</span> <span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">descriptor</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">current</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">addToContainer</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">handle</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">redraw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getContainerScrollAmount</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Point</span> 
        <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rv</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptBracket/Brace">)</span>; 
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">Container</span> <span class="ActionScriptBracket/Brace">)</span> 
            <span class="ActionScriptBracket/Brace">{</span> 
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">con</span>:<span class="ActionScriptDefault_Text">Container</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Container</span>; 
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">con</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">horizontalScrollPosition</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span>  
                    <span class="ActionScriptDefault_Text">rv</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> 0 
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">con</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">horizontalScrollPosition</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">con</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">maxHorizontalScrollPosition</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">rv</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">con</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">maxHorizontalScrollPosition</span> 
                <span class="ActionScriptReserved">else</span> 
                    <span class="ActionScriptDefault_Text">rv</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">con</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">horizontalScrollPosition</span>; 
                    
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">con</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">verticalScrollPosition</span>  <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span> 
                    <span class="ActionScriptDefault_Text">rv</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0 
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">con</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">verticalScrollPosition</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">con</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">maxVerticalScrollPosition</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">rv</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">con</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">maxVerticalScrollPosition</span> 
                <span class="ActionScriptReserved">else</span> 
                       <span class="ActionScriptDefault_Text">rv</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">con</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">verticalScrollPosition</span>; 
            <span class="ActionScriptBracket/Brace">}</span> 
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">rv</span>; 
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">updateHandlePositions</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">h</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">handles</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">]</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">scroll</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getContainerScrollAmount</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptOperator">!</span> <span class="ActionScriptDefault_Text">h</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span>; <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">handle</span>:<span class="ActionScriptDefault_Text">IHandle</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">h</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>                       
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOwnProperty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"rotation"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">identity</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;                    
                    <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">translate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleDescriptor</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">percentageOffset</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">/</span> 100<span class="ActionScriptBracket/Brace">)</span>  <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleDescriptor</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">offset</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptComment">// The tX 
</span>                                          <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleDescriptor</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">percentageOffset</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">/</span> 100<span class="ActionScriptBracket/Brace">)</span>  <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleDescriptor</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">offset</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptComment">//tempMatrix.translate(- Math.floor(handle.width / 2), - Math.floor(handle.height / 2));
</span>                    <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">translate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    
                    
                    
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p2</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tempMatrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">zero</span> <span class="ActionScriptBracket/Brace">)</span>;
                                         
                    <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotation</span>;
                    <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>  <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">scroll</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> ;
                    <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>  <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">scroll</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> ;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span>  <span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>  <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleDescriptor</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">percentageOffset</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">/</span> 100<span class="ActionScriptBracket/Brace">)</span>  <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleDescriptor</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">offset</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">scroll</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                    <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span>  <span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>  <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleDescriptor</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">percentageOffset</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">/</span> 100<span class="ActionScriptBracket/Brace">)</span>  <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleDescriptor</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">offset</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">scroll</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>   
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">redrawHandle</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">h</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">handles</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptOperator">!</span> <span class="ActionScriptDefault_Text">h</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span>; <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">handle</span>:<span class="ActionScriptDefault_Text">IHandle</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">h</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">redraw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">toRadians</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">degrees</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptBracket/Brace">)</span> :<span class="ActionScriptDefault_Text">Number</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">degrees</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span> <span class="ActionScriptOperator">/</span> 180;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">toDegrees</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">radians</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptBracket/Brace">)</span> :<span class="ActionScriptDefault_Text">Number</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">radians</span> <span class="ActionScriptOperator">*</span>  180 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">connectHandleEvents</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">handle</span>:<span class="ActionScriptDefault_Text">IHandle</span> <span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">descriptor</span>:<span class="ActionScriptDefault_Text">HandleDescription</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOUSE_DOWN</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onHandleDown</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onHandleDown</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">handle</span>:<span class="ActionScriptDefault_Text">IHandle</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">IHandle</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptOperator">!</span> <span class="ActionScriptDefault_Text">handle</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span>; <span class="ActionScriptBracket/Brace">}</span>
            
            
            <span class="ActionScriptComment">// If it has NO_ROLE we just send an event as it is more like a "click"
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleDescriptor</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">role</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HandleRoles</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">NO_ROLE</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HandleClickedEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">IHandle</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOUSE_MOVE</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onContainerMouseMove</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOUSE_UP</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onContainerMouseUp</span> <span class="ActionScriptBracket/Brace">)</span>;
    
                <span class="ActionScriptDefault_Text">currentDragRole</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleDescriptor</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">role</span>;
                <span class="ActionScriptDefault_Text">currentHandleConstraint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleDescriptor</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">constraint</span>;
                <span class="ActionScriptDefault_Text">handleBeginDrag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addToContainer</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">display</span>:<span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_childManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">display</span> <span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>       
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeFromContainer</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">display</span>:<span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_childManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">display</span> <span class="ActionScriptBracket/Brace">)</span>;            
        <span class="ActionScriptBracket/Brace">}</span>
        

        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeHandles</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">currentHandles</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">handles</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">handle</span>:<span class="ActionScriptDefault_Text">IHandle</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">currentHandles</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>               
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">handleCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&lt;=</span> 10 <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">handle</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                    <span class="ActionScriptDefault_Text">handleCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">handle</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">removeFromContainer</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">handle</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptBracket/Brace">)</span>;                  
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">handles</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptBracket/Brace">]</span>; 
            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">/* added by greg */</span>
        <span class="ActionScriptComment">// return the rotated point coordinates
</span>        <span class="ActionScriptComment">// help from http://board.flashkit.com/board/showthread.php?t=775357        
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getRotatedRectPoint</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">angle</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">point</span>:<span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">rotationPoint</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ix</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rotationPoint</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">rotationPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> : 0;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">iy</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rotationPoint</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">rotationPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> : 0;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m</span>:<span class="ActionScriptDefault_Text">Matrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptBracket/Brace">(</span> 1<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">m</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rotate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">angle</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">m</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tx</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">m</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ty</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
         <span class="ActionScriptComment">/* end added */</span>        
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
